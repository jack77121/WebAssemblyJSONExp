<!DOCTYPE html>
<html>
    <head><title>WebAssembly test</title><meta charset='utf-8'></head>
<body>
    <!-- <script src="funcExport_test.js"></script> -->
    <script src="json_handler.js"></script>

    <script>
        function write_1d_int32_array(ptr, array) {

            for (i = 0; i < array.length; i++) {
                Module.setValue(ptr, array[i], 'i32');
                ptr += 4;
            }

        }

        function read_1d_int32_array(ptr, length) {

            var array = [];

            for (i = 0; i < length; i++) {
                var value = Module.getValue(ptr + (i * 4), 'i32');
                array.push(value);
            }

            return array;
        }

        var mystring = '{"name": "ddd","total_supply": 6,"map": {"a": -2,"b": 87,"c": 4},"map2": [{"a":0},{"c":7}]}';
        // var teststring = "jack";
        var instance = new Module.MyJson(mystring);

        var initial_JSON = instance.GetMyJson();
        document.write("my initial JSON:");
        document.write("<br>");
        document.write(initial_JSON);
        document.write("<br>");

        var name = instance.GetName();
        document.write("name:");
        document.write("<br>");
        document.write(name);
        document.write("<br>");

        var total_supply = instance.GetSupply();
        document.write("supply:");
        document.write("<br>");
        document.write(total_supply);
        document.write("<br>");
        

        var valueOfMap = instance.GetMap("a");
        document.write("map:");
        document.write("<br>");
        document.write(valueOfMap);
        document.write("<br>");

        var valueOfMap2 = instance.GetMap2("c");
        document.write("map2:");
        document.write("<br>");
        document.write(valueOfMap2);
        document.write("<br>");

        instance.SetName("al;fajadsf");
      

        var name = instance.GetName();
        document.write("name after change:");
        document.write("<br>");
        document.write(name);
        document.write("<br>");

        instance.SetSupply(777);
        

        var total_supply = instance.GetSupply();
        document.write("supply after change:");
        document.write("<br>");
        document.write(total_supply);
        document.write("<br>");


        instance.Add_KeyInt("yaya", 8787987);

        instance.Add_KeyInt("kkkkk", 66666);
    

        var add_key_value = instance.GetMyJson();
        document.write("JSON after add key value:");
        document.write("<br>");
        document.write(add_key_value);
        document.write("<br>");


        instance.Add_KeyString("hahaha", "kerkerker");

        instance.Add_KeyString("zzz", "hhhh");

        var final_JSON = instance.GetMyJson();
        document.write("JSON after add key string:");
        document.write("<br>");
        document.write(final_JSON);
        document.write("<br>");



        // var strptr = Module._malloc(mystring.length);
        // Module.writeAsciiToMemory(mystring, strptr);

        // Module.ccall('SetJSON', // name of C function
        //     null, // return type
        //     ['number'], // argument types
        //     [strptr]); // arguments

        // Convert the resulting string to a JS string
        // var retstr = Pointer_stringify(retstrptr);
        // document.write(retstr);

        // SetJSON json string input, and pass into 

        
        

        // Get "c" and add 13 to its value, and return the whole json to display
        // var partjson = Module.ccall('GetBalance',
        //     'string',
        //     null,
        //     null);
        // document.write("Get Array");
        // document.write("<br>");
        // document.write(partjson);
        // document.write("<br>");

        // var nested = Module.ccall('GetNestedJSON',
        //     'number',
        //     null,
        //     null);
        // document.write("nested");
        // document.write("<br>");
        // document.write(nested);

        // Module.ccall('Temp',
        //     null,
        //     null,
        //     null);
        // var retarrayptr = Module.ccall('GetJSON', // name of C function
        //     'string', // return type
        //     null, // argument types
        //     null); // arguments

        // // Convert the resulting pointer to a JS array
        
        // document.write(retarrayptr);
    </script>

</body>

</html>